<!--
Sync Impact Report
- Version change: 1.5.0 -> 1.5.1 (PATCH)
- Last Amended: 2025-10-24
- Reason: 文本澄清、去重与风格改善（非语义性改动），包括消除条款重复、修正模糊表述、统一引用方式与增强面向人类阅读者的措辞。

- Summary of changes:
  - 消除第12-16条与第71-72条中重复的条款列表，改为对宪法原则的集中引用，避免冗余表述。
  - 澄清第1条、第5条与第10条的表述，明确“简体中文”为优先语言、注释与文档需面向人类阅读者，并给出可操作的校验点。
  - 将第19条（注释风格）并入第17/18条并移除孤立引用（文件内已有说明）。
  - 改善整体表述风格：删除长句重复引用，替换模糊词为明确要求或提供级别（MUST/SHOULD 的中文解释），并去除多余的列举性重复。

- Modified principles (高亮改动):
  - `提示词完整性与中文化`（原第1条）: 澄清校验点与可操作错误处理。
  - `文档与模板全部使用简体中文`（原第5条）: 明确“简体中文为主，必要时附英文摘要”的措辞与示例。
  - `中文注释覆盖`（原第10条）: 明确注释范围、格式建议与可校验项。
  - `头部注释规范 / 文档头部概述`（原第17/18条）: 合并与精简表述，移除冗余第19条。

- Templates / files verification results:
  - `.specify/templates/plan-template.md`: ✅ 已核验并包含宪法检查占位（头部注释与文档概述）。
  - `.specify/templates/spec-template.md`: ✅ 已核验并包含注释/头部概述提示。
  - `.specify/templates/tasks-template.md`: ✅ 已核验并包含任务样例提示（要求补全头部注释）。

- Follow-up TODOs:
  - TODO(ENFORCE_FILE_DOC_READABILITY): 建议在 CI/PR 中加入文件头部概述与注释结构检查（需要人工/CI 配置以实现自动化）。
  - TODO(UPDATE_RUNTIME_DOCS): 建议人工审计 runtime 指南与命令文件，确保所有运行时文档在语义与引用上与本宪法一致。
  - TODO(VERIFY_TEMPLATES_IN_CI): 在 CI 中执行一次模板与宪法一致性检查（自动化脚本或手工审计以完成）。

-->

# ReviewAI 宪法

## 核心原则

本节列出对项目开发、发布与审计具有约束力的治理原则。每条原则均为可检验的实践或要求，条文中“必须/不得”为强制性要求，必要时在注释中说明校验方法或示例实施步骤。

### 1. 提示词完整性与中文化（强制）

所有系统与 agent 的 system prompt 文件必须存在、非空并纳入版本管理（目录：`ReviewAIPrompt/`）。服务启动时由 `PromptLoader` 校验提示词完整性：缺失或为空应抛出明确的错误并中止启动。提示词以简体中文为主，必要时可附简短英文注释供参考；运行时优先使用中文文本。校验示例：CI 应在构建阶段执行 `PromptLoader` 的预加载校验或等效脚本。

理由：提示词决定模型行为，中文提示词能减少翻译歧义并提高对内可读性与审计性。

### 2. 启动可控与快速失败（强制）

服务引导阶段必须校验关键配置（例如 `OPENROUTER_BASE`、`STORAGE_ROOT`、必需环境变量与提示词）；若关键依赖不满足，应输出明确错误并停止启动，而非降级或进入不确定状态。建议：在启动日志中记录缺失项和修复建议以便运维快速定位。

理由：可重现的启动行为有助于定位故障并减少隐性运行风险。

### 3. 前后端契约化与解耦（强制）

前端与后端之间的集成只能依赖明确的网络契约（HTTP/REST、OpenAPI、JSON Schema 或等效协议）。前端不得依赖后端实现细节或共享运行时状态。任何契约变更必须随同兼容性说明与迁移策略提交 PR。

理由：契约化减少耦合、提升独立部署能力并支持版本化演进。

### 4. 后端服务边界与独立性（强制）

后端微服务之间应通过网络接口或消息总线通信，禁止通过共享数据库表、共享文件或进程间共享状态作为主要交互手段。跨服务变更必须包含契约变更说明与向后兼容策略。

理由：清晰边界有助于独立部署、缩小故障域并简化演进。

### 5. 文档与模板以简体中文为主（强制）

Speckit 相关文档、模板与命令文件应以**简体中文**为主要文本，采用面向人类阅读者的写作风格（清晰、示例驱动、步骤化）。可在必要位置附简短英文摘要以便国际协作。示例要求：README 中文版须包含示例命令、启动示例与 API 调用样例；模板头部需包含文件级概述。

理由：统一语言风格降低沟通成本并提高内部使用效率。

### 6. 移除长期未使用代码（强制）

不得在主分支长期保留大量注释掉或废弃的实现。废弃功能应通过 PR 和变更记录明确声明，并在合并后清理遗留实现。建议：采用代码审计或自动化扫描检测长期未触及的文件。

理由：减少维护成本并避免误导性实现。

### 7. 模块化设计与公开接口说明（强制）

所有公共模块应清晰划分边界并提供文档化的接口说明（参数、返回值、错误语义）。公开 API/函数应包含头部注释以说明用途、参数与示例（见第17条）。

理由：便于维护、自动生成文档与降低认知负担。

### 8. 后端服务必须包含中英文 README（强制）

每个后端服务目录（如 `services/circuit-agent/`）须包含两份 README：中文（`README.zh.md`）与英文（`README.md`），内容等效并同步。README 至少应包含：API 或端点列表、调用示例、启动/停止步骤、依赖说明、运行时配置与调试说明、以及流程图（Mermaid 或图片）。中文 README 应采用面向人类阅读者的写作风格并优先使用简体中文。

理由：保证对内对外文档可用性，同时提高团队阅读效率。

### 9. 完整测试体系与自动化报告（强制）

后端应具备单元测试、集成测试与必要的端到端测试，并在本地与 CI 中可自动运行，产出可读报告（JUnit/XML、HTML、覆盖率报告等）。涉及契约或运行时逻辑的 PR 必须包含相关测试或回归用例。

理由：自动化测试与报告为质量保证与回归防护的基础。

### 10. 中文注释与文档化注释覆盖（强制）

源代码必须包含规范的中文注释，优先使用简体中文并以面向人类阅读者的风格编写（清晰、示例驱动）。建议采用规范化格式（JSDoc/TSdoc/Doxygen 等），覆盖模块说明、公开函数的参数、返回值、错误语义与示例。CI 可加入注释覆盖检查或抽样审核作为质量门控。

理由：提高可维护性并便于自动化生成中文 API 文档。

### 11. 前端自动化测试工具與报告（强制）

前端验收与提交流程应包含浏览器级自动化测试（例如基于 chrome-devtools 协议或 Playwright/Chromium），覆盖关键路径并产出结构化报告（HTML/JSON），存放至统一 artifacts 目录（例如 `frontend/test-reports/`）。CI 应将报告摘要暴露于 PR 页面；测试失败的变更不得合并，除非有经批准的豁免。

理由：浏览器级测试在早期捕获 UI 回归并提升交付质量。

### 12. 代码生成工具输出合规性（强制）

所有代码生成工具（如 `speckit`、`cursor` 等）必须确保其输出满足本宪法的要求：提示词完整性、文档化注释、中文化、契约化接口、模块化设计与自动化测试门控等。建议：生成流程在 CI 中加入合规性检查。

理由：保障自动生成代码可直接审计并减少人工修正成本。

### 13. 配置管理与变更追踪（强制）

配置文件应纳入版本管理并遵循快速失败原则。配置变更需在 PR 中包含变更说明、风险评估与回滚/迁移策略，并记录在变更日志中。

理由：确保配置的可追溯性与稳定性。

### 14. 实验性功能管理（强制）

所有实验性功能须明确标注（feature flag 或 branch），并在引入前附带风险评估、回滚计划与测试策略。实验性功能不得破坏核心契约，且应在达到稳定后完成清理或转为正式功能。

理由：减少对主分支稳定性的影响并便于管理。

### 15. 测试门控与量化阈值（强制）

测试必须包含可量化的验收阈值（如覆盖率、性能或错误率目标）。阈值应在 PR 中标明，并在 CI 中作为合并门控项。

理由：确保测试质量并避免盲目放宽门控。

### 16. 文档发布与存档规范（强制）

文档应以中文为主（必要时附英文摘要），结构化书写并在文件头部包含文件级概述（见第18条）。文档发布路径与命名规则应统一并纳入版本管理。

理由：统一风格便于审计与交接。

### 17. 头部注释规范（强制）

公共函数/类/模块的定义处须包含结构化头部注释，至少包括：功能简介、输入参数说明、输出/返回说明（含异常语义）、最小使用示例。注释以中文为主并采用可被工具解析的格式。

理由：结构化注释利于自动化校验与文档生成。

### 18. 文档头部概述（强制）

每个重要文档或源文件头部须包含文件级概述，至少包括：功能概述、主要公开接口、使用规范与依赖关系。该概述用于快速理解文件职责并作为自动化可读性检查的目标。

理由：提高维护者快速理解代码与文档的能力。

## 其他约束

- 技术栈建议：Node.js >= 18、Vite + React + TypeScript（前端）。

- Artifact 存储：本地开发可用文件系统；生产环境应使用受控存储并限制访问权限。

## 开发流程要求

- 所有 speckit 模板与命令文件以中文维护；模板修改须在 PR 中说明对宪法的影响并列出受影响文件。

- 变更运行时提示词、契约或接口格式的 PR 必须包含迁移方案、向后兼容说明或版本迁移策略，并通过维护者审核。

## 治理

对本宪法的修改须通过仓库 PR 提议，PR 中应包含变更理由、受影响模板/文档、兼容性与迁移说明，并经至少两位审批者（其中至少一位为维护者或指定管护人）批准。紧急更改可先合并，但需在事后补录完整变更记录与回顾。

版本策略（语义化，由维护者指定）：

- MAJOR：不兼容的治理或原则重定义（删除或语义变更）。

- MINOR：新增原则或重要实践扩展。

- PATCH：措辞、排版或非语义修正。

合规审查建议：建议至少每季度进行一次合规审查，验证提示词覆盖、契约测试与后端 README 的完整性；发现不合规项应提交修复计划并在规定期限内完成。

**Version**: 1.5.1 | **Ratified**: 2025-09-29 | **Last Amended**: 2025-10-24
