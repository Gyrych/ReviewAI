<!-- aebf8523-f491-4740-8143-8c6281f752ab 4657dcaa-5266-4585-a1f2-b35c314be20c -->
# 确认单 agent（direct）评审流程实现与用户描述的映射

目标：逐文件、逐步骤验证代码是否实现用户描述的流程，并给出明确结论与证据路径（代码片段/文件位置），以及必要时的改进建议。

工作步骤：

1. 阅读并解析后端编排与直评实现（必查文件）：

- `services/circuit-agent/src/interface/http/routes/orchestrate.ts`
- `services/circuit-agent/src/interface/http/routes/directReview.ts`
- `services/circuit-agent/src/app/usecases/DirectReviewUseCase.ts`
- `services/circuit-agent/src/infra/prompts/PromptLoader.ts`
- `services/circuit-agent/src/infra/search/OpenRouterSearch.ts`
- `services/circuit-agent/src/infra/providers/OpenRouterVisionProvider.ts`（若存在）
- `services/circuit-agent/src/infra/providers/OpenRouterTextProvider.ts`（若存在）
- `services/circuit-agent/src/infra/storage/ArtifactStoreFs.ts`

输出：流程图（文本形式）将说明从接收文件到调用上游模型的完整消息组装、可选的网搜步骤、保存工件和最终报告返回点。

2. 阅读并解析前端上传/请求组装与会话（必查文件）：

- `frontend/src/components/FileUpload.tsx`
- `frontend/src/components/ReviewForm.tsx`
- `frontend/src/agents/circuit/ReviewForm.tsx`
- `frontend/src/App.tsx`

输出：确认用户如何上传（图片/pdf/文本）、如何组装 multipart 请求（字段名、enableSearch、requirements/specs/dialog/history 等），并抓取发送到后端的示例请求结构。

3. 验证“LLM 提取关键元器件清单”与“联网搜索并下载资料”的实现细节：

- 在后端查找是否存在对上传内容进行专门的元器件抽取（e.g., 结构化识别 usecase）以及其实现文件 `StructuredRecognitionUseCase` 或相关视觉解析逻辑。
- 确认 `SearchProvider` 的行为：是否仅返回检索结果摘要 URL 列表，还是会自动下载/抓取外部资料并把文件作为附件加入给 LLM。

输出：明确回答“是否自动下载并把元器件资料作为文件/attachment 随请求上传给 LLM”，并给出代码证据（引用文件与行号范围）。

4. 汇总并对照用户给出的 5 个流程步骤：针对每一步给出结论（满足/部分满足/不满足），并列出差异与改进建议（最小可行改动）。

5. 交付成果：

- 一个简短结论段，逐步对用户 5 步给出“满足/不满足”判定。
- 证据清单：每条结论对应的关键代码文件与行号（或代码片段引用）。
- 如有不满足之处，给出 1-2 个优先级最高、最小侵入的实现建议（含修改位置与简要实现思路）。

预期时间与交互：

- 我将先执行第 1-3 步的代码阅读并生成草稿结论。需要您确认我可以继续读取后端剩余相关文件（我目前已读取部分关键文件）。如您同意，我将继续并返回最终报告。

### To-dos

- [ ] 阅读并分析后端 direct（orchestrate + directReview + DirectReviewUseCase 等）流程并记录证据
- [ ] 阅读并分析前端上传与请求组装代码，确认 multipart 字段与参数名
- [ ] 验证 SearchProvider 是否执行自动下载并把资料作为 attachments 提交给 LLM
- [ ] 汇总对照用户描述的 5 个步骤，输出满足度结论、差异与改进建议